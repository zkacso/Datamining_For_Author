package hu.university.datamining;

import java.util.*;

public class MyDimensionReducer extends DimensionReducer
{
 //region stopwords
    private List<String> stopWords = Arrays.asList("another",
            "any",
            "are",
            "about",
            "above",
            "across",
            "after",
            "again",
            "against",
            "almost",
            "along",
            "among",
            "an",
            "and",
            "around",
            "as",
            "at",
            "a",
            "be",
            "been",
            "being",
            "but",
            "before",
            "behind",
            "between",
            "by",
            "can",
            "cannot",
            "could",
            "click",
            "did",
            "do",
            "does",
            "done",
            "during",
            "for",
            "four",
            "from",
            "get",
            "got",
            "had",
            "has",
            "have",
            "having",
            "he",
            "her",
            "here",
            "him",
            "himself",
            "his",
            "how",
            "however",
            "if",
            "is",
            "its",
            "itself",
            "i",
            "in",
            "into",
            "it",
            "may",
            "me",
            "might",
            "mr",
            "mrs",
            "much",
            "must",
            "my",
            "myself",
            "now",
            "our",
            "on",
            "or",
            "over",
            "of",
            "put",
            "puts",
            "said",
            "shall",
            "she",
            "should",
            "so",
            "somebody",
            "someone",
            "something",
            "somewhere",
            "such",
            "some",
            "same",
            "than",
            "that",
            "their",
            "them",
            "there",
            "therefore",
            "these",
            "they",
            "this",
            "those",
            "too",
            "then",
            "through",
            "to",
            "the",
            "under",
            "until",
            "up",
            "upon",
            "very",
            "was",
            "we",
            "were",
            "what",
            "when",
            "where",
            "whether",
            "which",
            "who",
            "why",
            "will",
            "would",
            "while",
            "with",
            "within",
            "without",
            "you",
            "your",
            "enable",
            "not",
            "a",
            "about",
            "above",
            "after",
            "again",
            "against",
            "all",
            "am",
            "an",
            "and",
            "any",
            "are",
            "aren't",
            "as",
            "at",
            "be",
            "because",
            "been",
            "before",
            "being",
            "below",
            "between",
            "both",
            "but",
            "by",
            "can't",
            "cannot",
            "could",
            "couldn't",
            "did",
            "didn't",
            "do",
            "does",
            "doesn't",
            "doing",
            "don't",
            "down",
            "during",
            "each",
            "few",
            "for",
            "from",
            "further",
            "had",
            "hadn't",
            "has",
            "hasn't",
            "have",
            "haven't",
            "having",
            "he",
            "he'd",
            "he'll",
            "he's",
            "her",
            "here",
            "here's",
            "hers",
            "herself",
            "him",
            "himself",
            "his",
            "how",
            "how's",
            "i",
            "i'd",
            "i'll",
            "i'm",
            "i've",
            "if",
            "in",
            "into",
            "is",
            "isn't",
            "it",
            "it's",
            "its",
            "itself",
            "let's",
            "me",
            "more",
            "most",
            "mustn't",
            "my",
            "myself",
            "no",
            "nor",
            "not",
            "of",
            "off",
            "on",
            "once",
            "only",
            "or",
            "other",
            "ought",
            "our",
            "ours\t",
            "ourselves",
            "out",
            "over",
            "own",
            "same",
            "shan't",
            "she",
            "she'd",
            "she'll",
            "she's",
            "should",
            "shouldn't",
            "so",
            "some",
            "such",
            "than",
            "that",
            "that's",
            "the",
            "their",
            "theirs",
            "them",
            "themselves",
            "then",
            "there",
            "there's",
            "these",
            "they",
            "they'd",
            "they'll",
            "they're",
            "they've",
            "this",
            "those",
            "through",
            "to",
            "too",
            "under",
            "until",
            "up",
            "very",
            "was",
            "wasn't",
            "we",
            "we'd",
            "we'll",
            "we're",
            "we've",
            "were",
            "weren't",
            "what",
            "what's",
            "when",
            "when's",
            "where",
            "where's",
            "which",
            "while",
            "who",
            "who's",
            "whom",
            "why",
            "why's",
            "with",
            "won't",
            "would",
            "wouldn't",
            "you",
            "you'd",
            "you'll",
            "you're",
            "you've",
            "your",
            "yours",
            "yourself",
            "yourselves",
            "a",
            "about",
            "above",
            "across",
            "after",
            "again",
            "against",
            "all",
            "almost",
            "alone",
            "along",
            "already",
            "also",
            "although",
            "always",
            "among",
            "an",
            "and",
            "another",
            "any",
            "anybody",
            "anyone",
            "anything",
            "anywhere",
            "are",
            "area",
            "areas",
            "around",
            "as",
            "ask",
            "asked",
            "asking",
            "asks",
            "at",
            "away",
            "b",
            "back",
            "backed",
            "backing",
            "backs",
            "be",
            "became",
            "because",
            "become",
            "becomes",
            "been",
            "before",
            "began",
            "behind",
            "being",
            "beings",
            "best",
            "better",
            "between",
            "big",
            "both",
            "but",
            "by",
            "c",
            "came",
            "can",
            "cannot",
            "case",
            "cases",
            "certain",
            "certainly",
            "clear",
            "clearly",
            "come",
            "could",
            "d",
            "did",
            "differ",
            "different",
            "differently",
            "do",
            "does",
            "done",
            "down",
            "down",
            "downed",
            "downing",
            "downs",
            "during",
            "e",
            "each",
            "early",
            "either",
            "end",
            "ended",
            "ending",
            "ends",
            "enough",
            "even",
            "evenly",
            "ever",
            "every",
            "everybody",
            "everyone",
            "everything",
            "everywhere",
            "f",
            "face",
            "faces",
            "fact",
            "facts",
            "far",
            "felt",
            "few",
            "find",
            "finds",
            "first",
            "for",
            "four",
            "from",
            "full",
            "fully",
            "further",
            "furthered",
            "furthering",
            "furthers",
            "g",
            "gave",
            "general",
            "generally",
            "get",
            "gets",
            "give",
            "given",
            "gives",
            "go",
            "going",
            "good",
            "goods",
            "got",
            "great",
            "greater",
            "greatest",
            "group",
            "grouped",
            "grouping",
            "groups",
            "h",
            "had",
            "has",
            "have",
            "having",
            "he",
            "her",
            "here",
            "herself",
            "high",
            "higher",
            "highest",
            "him",
            "himself",
            "his",
            "how",
            "however",
            "i",
            "if",
            "important",
            "in",
            "interest",
            "interested",
            "interesting",
            "interests",
            "into",
            "is",
            "it",
            "its",
            "itself",
            "j",
            "just",
            "k",
            "keep",
            "keeps",
            "kind",
            "knew",
            "know",
            "known",
            "knows",
            "l",
            "large",
            "largely",
            "last",
            "later",
            "latest",
            "least",
            "less",
            "le",
            "lets",
            "like",
            "likely",
            "long",
            "longer",
            "longest",
            "m",
            "made",
            "make",
            "making",
            "man",
            "many",
            "may",
            "me",
            "member",
            "members",
            "men",
            "might",
            "more",
            "most",
            "mostly",
            "mr",
            "mrs",
            "much",
            "must",
            "my",
            "myself",
            "n",
            "necessary",
            "need",
            "needed",
            "needing",
            "needs",
            "never",
            "new",
            "new",
            "newer",
            "newest",
            "next",
            "no",
            "nobody",
            "non",
            "noone",
            "not",
            "nothing",
            "now",
            "nowhere",
            "number",
            "numbers",
            "o",
            "of",
            "off",
            "often",
            "old",
            "older",
            "oldest",
            "on",
            "once",
            "one",
            "only",
            "open",
            "opened",
            "opening",
            "opens",
            "or",
            "order",
            "ordered",
            "ordering",
            "orders",
            "other",
            "others",
            "our",
            "out",
            "over",
            "p",
            "part",
            "parted",
            "parting",
            "parts",
            "per",
            "perhaps",
            "place",
            "places",
            "point",
            "pointed",
            "pointing",
            "points",
            "possible",
            "present",
            "presented",
            "presenting",
            "presents",
            "problem",
            "problems",
            "put",
            "puts",
            "q",
            "quite",
            "r",
            "rather",
            "really",
            "right",
            "right",
            "room",
            "rooms",
            "s",
            "said",
            "same",
            "saw",
            "say",
            "says",
            "second",
            "seconds",
            "see",
            "seem",
            "seemed",
            "seeming",
            "seems",
            "sees",
            "several",
            "shall",
            "she",
            "should",
            "show",
            "showed",
            "showing",
            "shows",
            "side",
            "sides",
            "since",
            "small",
            "smaller",
            "smallest",
            "so",
            "some",
            "somebody",
            "someone",
            "something",
            "somewhere",
            "state",
            "states",
            "still",
            "still",
            "such",
            "sure",
            "t",
            "take",
            "taken",
            "than",
            "that",
            "the",
            "their",
            "them",
            "then",
            "there",
            "therefore",
            "these",
            "they",
            "thing",
            "things",
            "think",
            "thinks",
            "this",
            "those",
            "though",
            "thought",
            "thoughts",
            "three",
            "through",
            "thus",
            "to",
            "today",
            "together",
            "too",
            "took",
            "toward",
            "turn",
            "turned",
            "turning",
            "turns",
            "two",
            "u",
            "under",
            "until",
            "up",
            "upon",
            "us",
            "use",
            "used",
            "uses",
            "v",
            "very",
            "w",
            "want",
            "wanted",
            "wanting",
            "wants",
            "was",
            "way",
            "way",
            "we",
            "well",
            "wells",
            "went",
            "were",
            "what",
            "when",
            "where",
            "whether",
            "which",
            "while",
            "who",
            "whole",
            "whose",
            "why",
            "will",
            "with",
            "within",
            "without",
            "work",
            "worked",
            "working",
            "works",
            "would",
            "x",
            "y",
            "year",
            "years",
            "yet",
            "you",
            "young",
            "younger",
            "youngest",
            "your",
            "yours",
            "z");
 //endregion

    private final double leastFrequentCutPercentage;
    private final double mostFrequentCutPercentage;
    private final int maxNumberOfWords;

    public MyDimensionReducer(double leastFrequentCutPercentage, double mostFrequentCutPercentage, int maxNumberOfWords)
    {
        this.leastFrequentCutPercentage = leastFrequentCutPercentage;
        this.mostFrequentCutPercentage = mostFrequentCutPercentage;
        this.maxNumberOfWords = maxNumberOfWords;
    }

    @Override
    public String[] filterStopWords(String[] words)
    {
        List<String> ret = new ArrayList<>();
        for(String word : words)
        {
            if(stopWords.contains(word))
                continue;
            ret.add(word);
        }
        return ret.toArray(new String[ret.size()]);
    }

    @Override
    public List<Article> reduceWordDimension(List<Article> articles)
    {
        HashMap<String, Integer> wordCount = calculateWordCount(articles);

        List<String> wordList = new ArrayList<>();
        wordList.addAll(wordCount.keySet());
        Collections.sort(wordList, (s1,s2) -> Integer.compare(wordCount.get(s1),wordCount.get(s2)));
        List<Article> reducedArticles = new ArrayList<>();
        for(Article a: articles)
        {
            StringBuilder sb = new StringBuilder();
            long articlesForAuthor = articles.stream().filter(art -> art.Author.compareTo(a.Author) == 0).count();
            if(articlesForAuthor < 15)
                continue;
            for(String word: a.TextAsWords)
            {
                int wordIdx = wordList.indexOf(word);
                if(wordIdx < wordList.size()*leastFrequentCutPercentage ||
                   wordIdx > wordList.size()*(1- mostFrequentCutPercentage) ||
                   wordIdx < wordList.size()*(1- mostFrequentCutPercentage) - maxNumberOfWords)
                    continue;
                sb.append(word);
                sb.append(" ");
            }
            if(sb.toString().length() == 0)
                throw new RuntimeException("Empty articles");
            reducedArticles.add(new Article(a.Author,sb.toString()));
        }
        return reducedArticles;
    }

    private static HashMap<String,Integer> calculateWordCount(List<Article> articles)
    {
        HashMap<String, Integer> wordCount = new HashMap<>();
        for(Article a: articles)
        {
            for(String word : a.TextAsWords)
            {
                if(wordCount.containsKey(word))
                    wordCount.replace(word,wordCount.get(word) + 1);
                else
                    wordCount.put(word,1);
            }
        }
        return wordCount;
    }
}
